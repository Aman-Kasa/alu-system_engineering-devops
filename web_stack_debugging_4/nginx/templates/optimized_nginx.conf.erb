# This is the optimized Nginx configuration for the web stack

server {
    listen 80 default_server;
    server_name <%= @server_name %>;

    root <%= @root %>;
    index index.html index.htm;

    location / {
        try_files $uri $uri/ =404;
    }

    # Optimization Settings
    client_max_body_size <%= @client_max_body_size %>;
    keepalive_timeout <%= @keepalive_timeout %>;
    worker_processes <%= @worker_processes %>;
    worker_connections <%= @worker_connections %>;

    # Enable gzip compression
    gzip on;
    gzip_types text/plain text/css application/javascript;
    gzip_min_length 1000;
    gzip_comp_level 6;

    # Log format and access logging
    access_log /var/log/nginx/access.log;
    error_log /var/log/nginx/error.log;

    # Timeout and connection settings
    client_body_timeout <%= @client_body_timeout %>;
    client_header_timeout <%= @client_header_timeout %>;

    # Additional optimization settings for performance
    sendfile on;
    tcp_nopush on;
    tcp_nodelay on;
    keepalive_timeout 65;
    types_hash_max_size 2048;
}
