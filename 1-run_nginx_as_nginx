#!/usr/bin/env bash
# Configure Nginx to run as nginx user on port 8080

# Kill any existing nginx processes
pkill -f nginx

# Modify nginx configuration
sed -i 's/user www-data/user nginx/' /etc/nginx/nginx.conf
sed -i 's/listen 80;/listen 8080;/' /etc/nginx/sites-available/default

# Ensure correct permissions
chown -R nginx:nginx /etc/nginx
chown -R nginx:nginx /var/log/nginx
chown -R nginx:nginx /var/lib/nginx

# Modify file permissions to allow nginx user to bind to port
chmod 755 /usr/sbin/nginx

# Start nginx as nginx user
su nginx -c "/usr/sbin/nginx -g 'daemon off;'"
